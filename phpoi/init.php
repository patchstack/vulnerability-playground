<?php

class ObjectInjection
{
   public $test;

   function __destruct(){
        die("PHP Object Injection: " . $this->test);
   }
}


function load_ig_data() {
	$data = isset( $_GET['data'] ) ? (string) $_GET['data'] : '';

	list( $hash, $value ) = explode( ':', $data, 2 );

	if ( empty( $value ) || empty( $hash ) ) {
		wp_send_json_error( 'Invalid data' );
	}

	$atts     = maybe_unserialize( base64_decode( $value ) );
	$tick     = ceil( time() / MONTH_IN_SECONDS );
	$expected = substr( wp_hash( $tick . $value ), -12, 10 );

	if ( ! hash_equals( $expected, $hash ) ) {
		wp_send_json_error( 'Invalid hash' );
	}


	wp_send_json_success( "testing success" );
}

add_action( 'wp_ajax_nopriv_load_ig_data', 'load_ig_data' );